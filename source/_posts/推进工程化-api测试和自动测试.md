title: 推进工程化-api测试和自动测试
date: 2017-03-01 09:52:03
tags: 工程化, 自动测试, api测试
---
时间总是过得很快，快到我连自己写的代码都不记得，快到我都不知道我曾经做过什么

<!--more-->

最近一周大概就在做这么一件事吧，node工程测试自动化。给现有的一个node工程加上了API测试，然后通过travis-ci实现测试自动化，在每次commit之后进行自动测试，travis会在测试失败的时候给你发邮件。

工程化的第一个环节，应该就是测试吧，测试的好处有很多，提高代码质量、提高工程质量、降低维护的时间、让你的代码更加有可读性、改起来也更加随心所欲，还有一个好处大家可能会觉得奇怪--节省时间。

比较典型的场景就是，修复了A Bug，却导致了B bug，如果测试覆盖到了，B bug就不会发生。再举一个场景，比如你加了一段你自己很有信心的代码，你总觉得这段代码肯定没问题，并且这段代码手动测试的话比较麻烦，要好几个步骤，所以你自信地说，可以了，没问题，额，然后就啪啪啪打脸，如果有代码测试，这打脸的机会就会少很多。

好吧，大家都知道测试很重要，但是很少人会去做，所以这是怎么一回事呢，我们来捋一下这个过程。

#### 什么样工程需要做测试？
只要不是一次性的工程，只要后面会有新需求的工程，都要加测试，大概就是说基本所有工程都得加测试，哈哈

#### 什么样的代码需要做测试？
重要的出入口。 这是代码测试的粒度问题，这是我后面还需要学习的内容，但目前来说，我觉得重要的出入口是需要测试的，比如对后台来说，接口就是重要的出入口，所以这里需要覆盖测试。

#### 工具
其实工具也不是必要的，但就目前的实践来看，mocha和chai是需要了解的两个工具

#### 阻碍大家实践测试的原因
第一个应该是开发模式的改变，不管是先写代码还是先写测试，但是这个怎么说的，有好的姿势干嘛不尝试呢？ 第二个原因是大家经常能听到的，浪费时间，工期紧......类似的，一堆。这里就是粒度的问题了，当你觉得浪费时间的时候，你可以只测试重要出入口。

#### 再说测试的好处
常听到的好处就不说了，说下代码可读性吧，加上测试，这段代码期待的输入输出就很清晰了，当你一个月之后来看自己代码，当别人需要看你代码，很快就能熟悉。 还有一个，节省时间，假设你写了一段代码，可能本来需要调接口来调试，也可能本来需要通过界面交互来调试，经常这个调试过程需要来回几次，如果这时覆盖了测试，可能之前的步骤只需要一次。 尤其调试是前后端不同人员之间的调试，界面调试是要点好几层交互的情况下，节省下来的时间也是不少的。

#### 成本和收获
任何事情都是有成本，在于你怎么考虑吧，学习新姿势当然有成本，但是考虑到这个新姿势带来的好处，嗯，学吧

#### 下一步
1、测试的粒度和团队实践。 
2、给travis加上自动部署。
3、继续探索新姿势--review。

